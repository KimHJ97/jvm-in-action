# 시스템 읽기와 쓰기 분리

## 코드 관점에서의 읽기와 쓰기 분리

 - `읽기와 쓰기를 분리하는 배경`

읽기 작업과 쓰기 작업의 경우 작업의 빈도가 비대칭적이다. 일반적으로 읽기 작업이 많이 발생한다.  
읽기와 쓰기가 함께 구성된 모델은 시간이 지남에 따라 많은 기능이 들어가게 되어 복잡하게 된다.  
또한, 읽기와 쓰기가 함께 있으면 권한이나 제어가 어렵게 된다.  

<br/>

 - `CQRS 개념`
    - Command (명령): 애플리케이션의 상태를 변경하는 작업을 나타냅니다.
    - Query (쿼리): 애플리케이션의 상태를 읽는 작업을 나타냅니다.
    - Responsibility Segregation (책임 분리): CQRS 패턴은 읽기 작업과 쓰기 작업을 분리하고, 각 작업에 대한 다른 모델을 사용하는 것을 강조합니다. 이로 인해 읽기 모델과 쓰기 모델이 서로 독립적으로 발전할 수 있습니다.
    - Event Sourcing (이벤트 소싱, 선택적): 이벤트 소싱은 모든 변경 사항을 이벤트 스트림으로 저장하고 이를 사용하여 현재 상태를 나타냅니다. 이를 통해 변경 이력을 추적하고 복구할 수 있으며, 다양한 읽기 모델을 구축하는 데 도움이 됩니다.
    - 약점: 쓰기 시점과 읽는 시점에 따른 데이터 동기화 이슈

CQRS는 "Command Query Responsibility Segregation"의 약어로, 소프트웨어 아키텍처 패턴 중 하나입니다. CQRS 패턴은 읽기 작업(Queries)과 쓰기 작업(Commands)을 분리하여 데이터베이스 및 응용 프로그램 아키텍처를 설계하는 방법을 설명합니다. 이 패턴은 특히 복잡한 도메인 및 대규모 애플리케이션에서 유용하며, 동시성과 확장성을 향상시키고 유지보수성을 향상시키는 데 도움이 됩니다.  

CQRS 패턴을 사용하면 읽기 및 쓰기 작업에 대한 요구 사항을 분리하고 최적화된 데이터 모델 및 스토리지 솔루션을 사용하여 각 작업을 처리할 수 있습니다. 이는 응용 프로그램의 성능을 향상시키고 확장성을 갖추게 하는 데 도움이 되며, 도메인 복잡성을 관리하고 유지 보수를 단순화하는 데도 도움이 됩니다.  

<br/>

 - `CQRS 도입 고려 대상`

읽기가 많은 서비스나 시스템, 읽기 성능을 향상시켜야 하는 상황, 복잡한 도메인, 비즈니스 정책이 자주 변경되는 경우, 공동 작업 데이터 저장소 등  

<br/>

## 데이터 저장소 관점에서의 읽기와 쓰기 분리

 - `데이터 저장소의 읽기와 쓰기`
    - RDB의 Replication 지원
        - MySQL, PostgreSQL 등
    - Master
        - 읽기, 등록, 수정, 삭제 모두 가능
        - Slave에 이벤트를 바이너리 로그를 전달
    -  Slave
        - Master로부터 받은 바이너리 로그를 반영
        - 읽기 전용
 - `데이터 저장소의 읽기 쓰기 분리의 장점`
    - 부하 분산 -> 성능 향상
    - 쓰기 속도 향상, 읽기 속도 향상
    - 확장 가능성
    - 분석성 향삭 - 읽기 전용 데이터베이스
    - 장애 회복성
 - `CQRS 관련 코드와의 연동`
    - 읽기 관련 모델 -> 읽기 데이터 베이스
        - ProductReadService
    - 쓰기 관련 모델 -> 쓰기 데이터 베이스
        - ProductWriteService

