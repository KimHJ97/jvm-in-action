# 서비스 장애 대응하기

## 서비스 장애

서비스 장애(Service Outage)란, 컴퓨터 시스템, 네트워크, 애플리케이션 또는 서비스가 의도치 않게 동작하지 않거나, 정상적인 서비스 수행이 불가능한 상태를 의미합니다. 서비스 장애는 다양한 원인으로 발생할 수 있으며, 이로 인해 사용자에게 불편을 초래하거나 비즈니스에 손해를 줄 수 있습니다.  
 - 하드웨어 장애: 서버, 스토리지 장치, 네트워크 장비 등의 하드웨어 장애는 서비스의 가용성을 저하시킬 수 있습니다.
 - 소프트웨어 오류: 버그, 메모리 누수, 예외 상황 처리 부재 등 소프트웨어 문제로 인한 서비스 중단이 발생할 수 있습니다.
 - 보안 공격: DDoS 공격, 데이터 유출, 악성 코드 등의 보안 공격은 서비스를 마비시킬 수 있습니다.
 - 인프라 구성 오류: 잘못된 구성 설정, 용량 부족, 오버로드된 서버 등의 인프라 구성 오류가 서비스 장애의 원인이 될 수 있습니다.
 - 업데이트 및 배포 오류: 업데이트나 배포 중에 오류가 발생하면 서비스 장애가 발생할 수 있습니다.

<br/>

## 장애 알림 받기

 - __장애 알림 종류__
    - 수동 알림
        - 서비스 채널
        - 사람이 장애를 확인하고 관련한 조직, 팀, 구성원에게 알린다.
    - 자동 알림
        - 장애 알림 채널
        - 임계점 설정 후 이를 넘으면 관련한 조직, 팀, 구성원에게 자동으로 알림이 간다.
 - __장애 알림 관련 임계점 - 비즈니스 임계점__
    - 검색 요청량
    - 주문 및 결제의 개수
    - 상품 등록의 개수
 - __장애 알림 관점 임계점 - 시스템 임계점__
    - 서버의 HTTP 500 에러 개수
    - CPU 사용률
    - 메모리
    - 데이터베이스 커넥션
    - 자동화 테스트 실패
    - 배치 시스템 실패
 - __장애 알림 방식__
    - 슬랙, 전화, 문자, 카카오톡 등
 - __장애 알림 정보__
    - 알림 발생처, 알림 정보, 관련 웹링크 등
    - 장애 알림에 많은 정보를 담아 알림 이후의 액션이 가능하도록 한다.
 - __장애 알림 수신 후 대처__
    - 담당 도메인 팀에 상황 전파
    - 모니터링 시스템 확인
    - 로깅 확인
    - 서비스 이상 유무 확인
    - 데이터 확인
 - __장애 알림 이후__
    - 장애 처리: 장애 해결을 위한 서비스 정상화
    - 장애 기록: 장애 처리에 대해서 타임라인별로 기록
    - 장애로 인한 영향도 분석
    - 장애 등급 최종 판정
    - 장애 리뷰 작성 및 진행 여부

<br/>

## 장애 대응 절차

장애 대응 절차는 조직이 시스템 또는 서비스 장애가 발생했을 때 효과적으로 대처하고 복구하기 위한 일련의 단계와 절차를 나타냅니다. 이러한 절차는 장애 발생 시 빠르게 대응하고 문제를 해결하는 데 도움을 줍니다.  

 - __장애 대응 절차__
    - 장애 전파 및 담당자 지정
        - 장애 알림을 받으면 장애 티켓을 생성한다.
        - 장애 티켓과 관련한 소통 채널을 생성한다.
        - 장애 소통 채널을 전체 엔지니어 관련 조직에 공유한다.
        - 장애의 현재 진행 상황을 공유한다.
    - 장애 처리
        - 해당 장애에 대한 소통 채널을 생성한다.
        - 해당 채널에 모인 구성원이 빠르게 정상화 방안을 모색한다.
    - 장애 종료
    - 장애 리뷰 (장애 진단)
        - 가장 마지막에 변경된 것은? (배포, 설정 변경, 데이터 마이그레이션, 외부 요인, 마케팅 및 광고 이벤트)
 - __장애 처리 기록 방식__
    - 장애 별로 생성하여 기록, 공유, 관리를 한다.
    - BTS(Bug Tracking System): JIRA, Github Issues
    - 위키, 노션
 - __장애 공지 템플릿__
    - 장애 관련해서 구성원이 알아야 할 필수적으로 들어갈 항목을 정하고 이를 공유한다.
    - 장애 발생 시간
    - 장애 증상
    - 장애 타임 라인
    - 장애 인지 채널
    - 고객 영향도
    - 장애 원인
    - 장애 처리 방법
```
감지 (Detection)
장애를 빠르게 감지하는 것이 중요합니다.
이를 위해 모니터링 시스템, 로그, 경보 및 알림 메커니즘을 사용합니다.
장애 발생 시 자동으로 경보를 생성하고 관련 담당자에게 알림을 보냅니다.

평가 (Assessment)
감지된 장애를 평가하고 문제의 원인과 영향을 파악합니다.
장애의 중요성과 긴급성을 판단하여 대응 우선순위를 설정합니다.

통보 (Notification)
관련 담당자 및 팀에게 장애 상황을 통보합니다.
통보 방법에는 이메일, SMS, 전화 또는 모니터링 대시보드를 통한 알림 등이 포함될 수 있습니다.

대응 (Response)
장애에 대응하기 위한 조치를 취합니다.
이 단계에는 담당자 또는 팀에 의한 조치, 자동화된 스크립트 실행, 서비스 재시작, 복구 절차 수행 등이 포함될 수 있습니다.

문제 해결 (Resolution)
장애의 원인을 식별하고 문제를 해결합니다.
원인 분석 및 조치를 통해 장애를 완전히 해결하고, 추가 장애를 예방하기 위한 조치를 취합니다.

모니터링 및 복구 (Monitoring and Recovery)
문제 해결 후 시스템을 모니터링하고, 정상 상태로 복구됐는지 확인합니다.
필요한 경우 복구 절차를 수행하고 성능과 가용성을 모니터링하여 장애 재발을 방지합니다.

보고 및 문서화 (Reporting and Documentation)
장애 발생과 대응 과정을 기록하고 문서화합니다.
장애 원인 분석 및 조치 내용을 기록하여 미래에 동일한 문제에 대한 대응을 개선합니다.

재평가 (Post-Incident Review)
장애 대응 후에는 재평가를 수행하여 대응 과정을 평가하고 개선점을 도출합니다.
장애 발생을 예방하기 위한 추가적인 조치를 결정합니다.

학습과 개선 (Learning and Improvement)
장애를 통해 얻은 경험을 팀 내부 및 조직 전체에 공유하고, 대응 절차와 모니터링 시스템을 개선하는 데 활용합니다.
지속적인 개선을 통해 장애 대응 능력을 향상시킵니다.
```

<br/>

## 장애 후속 조치

장애 후속 조치(Incident Follow-up)는 장애 대응 후에 수행되는 활동으로, 장애가 발생한 이후에 기술적, 조직적, 그리고 학습 관점에서 계획적으로 진행됩니다.  
 - 원인 분석, 조치 및 예방 조치 결정, 문서화, 보고 및 통보, 학습과 개선, 감시 및 모니터링 강화, 대응 프로세스 개선, 평가 및 검토

<br/>

### 장애 원인 분석

 - 5 Whys
    - 반복적인 Why 질문을 통해 문제의 근본적인 원인을 파해치는 방법
    - 주제나 문제에 대해서 깊게 알 수 있도록 질문한다.
    - 문제 자체를 파악하고, 솔루션을 도출하기에 좋다.
```
5 Whys 예시

[문제 발생] 메인 배너가 홈에 노출되지 않았다.
• Q1 - 왜 메인 배너가 홈에 노출되지 않았나?
    • A1 - Frontend 시스템에서 노출할 배너를 조회했지만 조회되지 않아 배너가 노출되지 않았다.
• Q2 - 왜 Frontend 시스템에서 노출할 배너를 조회했지만 조회되지 않았나?
    • A2 - 노출할 배너를 담당자가 등록을 해야하는데 등록하지 않았다.
• Q3 - 왜 담당자는 배너를 등록하지 않았나?
    • A3 - 담당자가 배너 등록해야 하는 것을 인지하지 못했다.
• Q4 - 담당자는 왜 배너 등록해야 하는 것을 인지하지 못했나?
    • A4 - 담당자는 배너 등록 관리를 수동으로 하다보니 등록 여부를 확인하지 못했다.
• Q5 - 왜 담당자는 배너 등록 관리를 수동으로 했나?
    • A5 - 배너의 관리 도구가 없어서 수동으로 직접 등록 여부를 확인하고 있다.
```

<br/>

### 장애 재발 방지

근본 원인을 도출하고 재발하지 않도록 방지한다.  
 - 포카요케
    - 도요타에서 나온 사람의 실수를 방지하는 방법으로 여러가지 행동 제약이나 강제하는 방법을 말한다. (실수를 원천적으로 발생하지 않게 하는 것)
 - 포스트모텀
    - 장애의 대해서 필요한 정보를 모으고, 이를 통해 배우고 최종적으로 장애의 재발 방지를 하도록 기록하는 것
    - 부검, 검시
    - 장애 발생 후 이에 대한 상세한 기록
    - 장애의 영향도
    - 장애를 해결하기 위해 했던 행동들
    - 장애 근본 원인
    - 재발 방지 대책

<br/>

### 장애 후속 조치 결과물

 - 장애 날짜, 시간, 기간
 - 작성자
 - 장애 상태
 - 장애 요약
 - 영향도
 - 장애 탐지
 - 근본 원인
 - 해결책
 - 장애 등급
 - 교훈 (잘 진행된 부분, 미흡한 부분, 운이 좋았던 부분)
 - 시간대별 조치 사항(타임라인, 장애 발생 후 했던 모든 행동 기록)
 - 추가 정보 (링크)
 - 재발 방지 대책

